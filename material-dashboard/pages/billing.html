<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>攻击配置管理系统</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --success: #06d6a0;
      --info: #2196f3;
      --warning: #ffd166;
      --danger: #ef476f;
      --dark: #1e293b;
      --light: #f8f9fa;
      --gray: #64748b;
      --card-bg: #ffffff;
      --body-bg: #f0f2f5;
      --sidebar: #1e293b;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--body-bg);
      color: #334155;
      padding: 0;
      min-height: 100vh;
    }
    
    .app-container {
      display: flex;
      min-height: 100vh;
    }
    
    /* 导航栏 */
    .navbar {
      background: linear-gradient(120deg, #1e3a8a, #4361ee);
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
    }
    
    .navbar-brand {
      display: flex;
      align-items: center;
      font-weight: 700;
      font-size: 1.5rem;
      color: white;
    }
    
    .navbar-brand i {
      margin-right: 10px;
      font-size: 1.8rem;
    }
    
    /* 主内容区 */
    .main-content {
      flex: 1;
      padding: 25px;
      overflow-y: auto;
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .page-title h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 5px;
    }
    
    .page-title p {
      color: var(--gray);
      margin: 0;
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
    }
    
    .btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s;
      border: none;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }
    
    .btn-light {
      background-color: #f0f4ff;
      color: var(--primary);
    }
    
    .btn-light:hover {
      background-color: #e2e8ff;
    }
    
    .btn-outline-primary {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline-primary:hover {
      background: var(--primary);
      color: white;
    }
    
    .btn-outline-success {
      background: transparent;
      border: 1px solid var(--success);
      color: var(--success);
    }
    
    .btn-outline-success:hover {
      background: var(--success);
      color: white;
    }
    
    /* 统计卡片 */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stats-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    
    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .stats-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 4px;
      width: 100%;
    }
    
    .stats-card.primary::before {
      background: var(--primary);
    }
    
    .stats-card.success::before {
      background: var(--success);
    }
    
    .stats-card.warning::before {
      background: var(--warning);
    }
    
    .stats-card.danger::before {
      background: var(--danger);
    }
    
    .stats-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .stats-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .stats-card.primary .stats-icon {
      background: rgba(67, 97, 238, 0.1);
      color: var(--primary);
    }
    
    .stats-card.success .stats-icon {
      background: rgba(6, 214, 160, 0.1);
      color: var(--success);
    }
    
    .stats-card.warning .stats-icon {
      background: rgba(255, 209, 102, 0.1);
      color: var(--warning);
    }
    
    .stats-card.danger .stats-icon {
      background: rgba(239, 71, 111, 0.1);
      color: var(--danger);
    }
    
    .stats-content h3 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .stats-content p {
      color: var(--gray);
      margin: 0;
    }
    
    /* 配置列表 */
    .config-card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    .card-header {
      padding: 20px;
      background: white;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-header h2 {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card-tools {
      display: flex;
      gap: 10px;
    }
    
    .search-box {
      position: relative;
      width: 250px;
    }
    
    .search-box input {
      width: 100%;
      padding: 8px 15px 8px 40px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      transition: all 0.3s;
    }
    
    .search-box input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
      background: white;
    }
    
    .search-box i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    thead {
      background: #f1f5f9;
    }
    
    th {
      padding: 16px 20px;
      text-align: left;
      font-weight: 600;
      color: var(--gray);
      border-bottom: 1px solid #e2e8f0;
    }
    
    tbody tr {
      transition: background 0.2s;
    }
    
    tbody tr:hover {
      background: #f8fafc;
    }
    
    td {
      padding: 14px 20px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .status-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .status-active {
      background: rgba(6, 214, 160, 0.15);
      color: #06a075;
    }
    
    .status-inactive {
      background: rgba(239, 71, 111, 0.15);
      color: #c13b5d;
    }
    
    .badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .badge-primary {
      background: rgba(67, 97, 238, 0.15);
      color: var(--primary);
    }
    
    .badge-success {
      background: rgba(6, 214, 160, 0.15);
      color: var(--success);
    }
    
    .badge-warning {
      background: rgba(255, 209, 102, 0.15);
      color: var(--warning);
    }
    
    .badge-danger {
      background: rgba(239, 71, 111, 0.15);
      color: var(--danger);
    }
    
    .badge-info {
      background: rgba(33, 150, 243, 0.15);
      color: var(--info);
    }
    
    .action-buttons {
      display: flex;
      gap: 8px;
    }
    
    .btn-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      padding: 0;
    }
    
    .no-configs {
      text-align: center;
      padding: 50px 20px;
    }
    
    .no-configs i {
      font-size: 60px;
      color: #cbd5e1;
      margin-bottom: 20px;
    }
    
    .no-configs h4 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: var(--dark);
    }
    
    .no-configs p {
      color: var(--gray);
      margin-bottom: 20px;
    }
    
    /* 模态框样式 */
    .modal-content {
      border-radius: 12px;
      overflow: hidden;
      border: none;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }
    
    .modal-header {
      background: linear-gradient(120deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px;
      border: none;
    }
    
    .modal-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }
    
    .modal-body {
      padding: 25px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      transition: all 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
      background: white;
    }
    
    .accordion {
      margin-top: 20px;
    }
    
    .accordion-button {
      padding: 15px;
      font-weight: 500;
      background: #f8fafc;
      border-radius: 8px !important;
      border: 1px solid #e2e8f0;
    }
    
    .accordion-button:not(.collapsed) {
      background: rgba(67, 97, 238, 0.05);
      color: var(--primary);
      box-shadow: none;
    }
    
    .accordion-body {
      padding: 20px;
      background: #f8fafc;
      border-radius: 0 0 8px 8px;
      border: 1px solid #e2e8f0;
      border-top: none;
    }
    
    .param-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .param-item {
      margin-bottom: 15px;
    }
    
    .modal-footer {
      padding: 15px 25px;
      border-top: 1px solid #e2e8f0;
      background: #f8fafc;
    }
    
    /* 页脚 */
    footer {
      background: var(--dark);
      color: rgba(255, 255, 255, 0.7);
      padding: 30px 0;
      margin-top: 30px;
    }
    
    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .footer-links a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      margin-left: 20px;
      transition: all 0.2s;
    }
    
    .footer-links a:hover {
      color: white;
      text-decoration: underline;
    }
    
    /* 响应式调整 */
    @media (max-width: 992px) {
      .app-container {
        flex-direction: column;
      }
    }
    
    @media (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .action-buttons {
        width: 100%;
        flex-wrap: wrap;
      }
      
      .btn {
        flex: 1;
        min-width: 120px;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .param-group {
        grid-template-columns: 1fr;
      }
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      padding: 15px 25px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateX(110%);
      transition: transform 0.3s ease;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast-success {
      background: linear-gradient(120deg, var(--success), #0a8754);
    }
    
    .toast-error {
      background: linear-gradient(120deg, var(--danger), #b91c1c);
    }
    
    .toast i {
      font-size: 24px;
    }
  </style>
</head>

<body>
  <!-- 导航栏 -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="material-icons">security</i>
        攻击配置管理系统
      </a>
      <div class="d-flex align-items-center">
        <div class="me-3 text-white">
          <i class="material-icons me-1">account_circle</i>
          <span id="usernameDisplay">管理员</span>
        </div>
        <button class="btn btn-outline-light btn-sm">
          <i class="material-icons">logout</i>
        </button>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <!-- 主内容区 -->
    <main class="main-content">
      <!-- 页面标题和操作按钮 -->
      <div class="page-header">
        <div class="page-title">
          <h1>攻击配置管理</h1>
          <p>管理您的攻击类型、策略和高级设置</p>
        </div>
        <div class="action-buttons">
          <button class="btn btn-light" id="addNewConfigBtn">
            <i class="material-icons">add</i> 添加配置
          </button>
          <button class="btn btn-outline-primary" id="sendConfigBtn">
            <i class="material-icons">send</i> 发送配置
          </button>
          <button class="btn btn-outline-success" id="executeAttackBtn">
            <i class="material-icons">play_arrow</i> 执行攻击
          </button>
        </div>
      </div>
      
      <!-- 统计卡片 -->
      <div class="stats-container">
        <div class="stats-card primary">
          <div class="stats-header">
            <div class="stats-icon">
              <i class="material-icons">list_alt</i>
            </div>
          </div>
          <div class="stats-content">
            <h3 id="totalConfigs">0</h3>
            <p>总配置数</p>
          </div>
        </div>
        
        <div class="stats-card success">
          <div class="stats-header">
            <div class="stats-icon">
              <i class="material-icons">check_circle</i>
            </div>
          </div>
          <div class="stats-content">
            <h3 id="activeConfigs">0</h3>
            <p>活跃配置</p>
          </div>
        </div>
        
        <div class="stats-card warning">
          <div class="stats-header">
            <div class="stats-icon">
              <i class="material-icons">schedule</i>
            </div>
          </div>
          <div class="stats-content">
            <h3 id="attackTypes">6</h3>
            <p>攻击类型</p>
          </div>
        </div>
        
        <div class="stats-card danger">
          <div class="stats-header">
            <div class="stats-icon">
              <i class="material-icons">bolt</i>
            </div>
          </div>
          <div class="stats-content">
            <h3 id="executedAttacks">0</h3>
            <p>已执行攻击</p>
          </div>
        </div>
      </div>
      
      <!-- 配置列表 -->
      <div class="config-card">
        <div class="card-header">
          <h2>
            <i class="material-icons">list</i>
            攻击配置列表
            <span class="badge bg-primary" id="configCounter">0</span>
          </h2>
          <div class="card-tools">
            <div class="search-box">
              <i class="material-icons">search</i>
              <input type="text" id="searchInput" placeholder="搜索配置...">
            </div>
            <div class="dropdown">
              <button class="btn btn-light dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown">
                <i class="material-icons">filter_list</i> 筛选
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item filter-option" href="#" data-filter="all">全部配置</a></li>
                <li><a class="dropdown-item filter-option" href="#" data-filter="active">活跃配置</a></li>
                <li><a class="dropdown-item filter-option" href="#" data-filter="inactive">已禁用</a></li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>配置名称</th>
                <th>攻击类型</th>
                <th>攻击策略</th>
                <th>状态</th>
                <th>创建时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="configTableBody">
              <!-- 配置列表会动态填充 -->
            </tbody>
          </table>
        </div>
        
        <div id="noConfigsMessage" class="no-configs d-none">
          <i class="material-icons">folder_off</i>
          <h4>暂无配置</h4>
          <p>点击"添加新配置"按钮创建您的第一个攻击配置</p>
          <button class="btn btn-primary mt-3" id="addFirstConfigBtn">
            <i class="material-icons">add</i> 添加配置
          </button>
        </div>
      </div>
    </main>
  </div>
  
  <!-- 配置弹窗 -->
  <div class="modal fade" id="configModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="material-icons">settings</i>
            <span id="modalTitle">添加新攻击配置</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="attackConfigForm">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="attackType">攻击类型</label>
                  <select class="form-control" id="attackType" name="attackType">
                    <option value="AdversarialAttack">对抗攻击</option>
                    <option value="FET">快速评估测试</option>
                    <option value="BackDoorAttack">后门攻击</option>
                    <option value="PoisoningAttack">数据投毒</option>
                    <option value="RLMI">强化学习攻击</option>
                    <option value="GIAforNLP">通用NLP攻击</option>
                    <option value="ModelStealingAttack">模型窃取攻击</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="attackStrategy">攻击策略</label>
                  <select class="form-control" id="attackStrategy" name="attackStrategy"></select>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="configName">配置名称 <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="configName" placeholder="输入配置名称" required>
            </div>
            
            <div class="form-group">
              <label for="description">攻击描述</label>
              <textarea class="form-control" id="description" rows="3" placeholder="输入攻击描述..."></textarea>
            </div>
            
            <div class="accordion" id="advancedSettingsAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingAdvanced">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdvanced">
                    <i class="material-icons me-2">tune</i> 高级设置
                  </button>
                </h2>
                <div id="collapseAdvanced" class="accordion-collapse collapse show">
                  <div class="accordion-body">
                    <div class="param-group" id="advancedSettingsContent">
                      <!-- 动态生成的高级设置字段将在这里显示 -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="saveConfigBtn">保存配置</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 页脚 -->
  <footer>
    <div class="footer-content">
      <div class="copyright">
        © 2023, 攻击配置管理系统 | 安全研究平台
      </div>
      <div class="footer-links">
        <a href="#">关于我们</a>
        <a href="#">隐私政策</a>
        <a href="#">使用条款</a>
        <a href="#">帮助中心</a>
      </div>
    </div>
  </footer>
  
  <!-- Toast 通知 -->
  <div id="toastContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 攻击配置数据
    const attackConfigs = {
      attackTypes: ['AdversarialAttack', 'FET', 'BackDoorAttack', 'PoisoningAttack', 'RLMI', 'GIAforNLP', 'ModelStealingAttack'],
      recipes: {
        AdversarialAttack: [
          'A2TYoo2021', 'BAEGarg2019', 'BERTAttackLi2020', 'GeneticAlgorithmAlzantot2018',
          'FasterGeneticAlgorithmJia2019', 'DeepWordBugGao2018', 'HotFlipEbrahimi2017',
          'InputReductionFeng2018', 'Kuleshov2017', 'MorpheusTan2020', 'Seq2SickCheng2018BlackBox',
          'TextBuggerLi2018', 'TextFoolerJin2019', 'PWWSRen2019', 'IGAWang2019', 'Pruthi2019',
          'PSOZang2020', 'CheckList2020', 'CLARE2020', 'FrenchRecipe', 'SpanishRecipe', 'ChineseRecipe'
        ],
        FET: ['default'],
        BackDoorAttack: ['BadNets','AddSent','SynBkd','StyleBkd','POR','TrojanLM','SOS','LWP','EP','NeuBA','LWS','RIPPLES'],
        PoisoningAttack: ['default'],
        RLMI: ['default'],
        GIAforNLP: ['default'],
        ModelStealingAttack: ['default']
      },
      defaults: {
        AdversarialAttack: {
          use_local_model: true,
          use_local_tokenizer: true,
          use_local_dataset: false,
          attack_nums: 2
        },
        FET: {
          seed: 42,
          attack_batch: 2,
          attack_nums: 1,
          distance_func: 'l2',
          population_size: 300,
          tournsize: 5,
          crossover_rate: 0.9,
          mutation_rate: 0.1,
          max_generations: 2,
          halloffame_size: 30
        },
        BackDoorAttack: {
          sample_metrics: [],
          defender: 'None'
        },
        PoisoningAttack: {
          poisoning_rate: 0.1,
          epochs: 10
        },
        RLMI: {
          seed: 42,
          seq_length: 20,
          target_label: 0,
          max_iterations: 2000,
          min_input_length: 2,
          max_input_length: 5,
          num_generation: 1000
        },
        GIAforNLP: {
          optimizer: 'Adam',
          attack_batch: 2,
          attack_nums: 1,
          distance_func: 'l2',
          attack_lr: 0.01,
          attack_iters: 10
        },
        ModelStealingAttack: {
          attack_nums: 2,
          query_num: 320,
          prompt: "This is a movie review.",
          pool_subsize: 1766,
          method: "MeaeQ",
          al_sample_method: "uncertainty",
          al_sample_batch_num: 20
        }
      },
      descriptions: {
        AdversarialAttack: "通过微小的、难以察觉的扰动来欺骗模型，使其做出错误的预测",
        FET: "快速评估测试方法，用于快速评估模型在特定攻击下的表现",
        BackDoorAttack: "在训练数据中植入后门，使模型在特定触发条件下表现出异常行为",
        PoisoningAttack: "通过污染训练数据来降低模型性能或植入后门",
        RLMI: "强化学习方法，通过与环境交互来优化攻击策略",
        GIAforNLP: "针对自然语言处理模型的通用攻击方法",
        ModelStealingAttack: "通过查询目标模型来窃取其结构和参数"
      },
      typeNames: {
        AdversarialAttack: "对抗攻击",
        FET: "快速评估测试",
        BackDoorAttack: "后门攻击",
        PoisoningAttack: "数据投毒",
        RLMI: "强化学习攻击",
        GIAforNLP: "通用NLP攻击",
        ModelStealingAttack: "模型窃取"
      }
    };
    
    // 存储配置数据
    let configList = [];
    let currentConfigId = null;
    let executedAttacks = 0;
    let currentFilter = 'all';
    
    // DOM 加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化攻击策略下拉菜单
      updateAttackStrategies();
      
      // 加载示例配置
      loadSampleConfigs();
      renderConfigTable();
      updateStats();
      
      // 添加新配置按钮点击事件
      document.getElementById('addNewConfigBtn').addEventListener('click', showAddConfigModal);
      document.getElementById('addFirstConfigBtn').addEventListener('click', showAddConfigModal);
      
      // 攻击类型改变事件
      document.getElementById('attackType').addEventListener('change', function() {
        updateAttackStrategies();
        updateAdvancedSettings(this.value);
        
        // 更新描述
        const type = this.value;
        document.getElementById('description').value = attackConfigs.descriptions[type] || '';
      });
      
      // 保存配置按钮点击事件
      document.getElementById('saveConfigBtn').addEventListener('click', saveConfig);
      
      // 发送配置按钮点击事件
      document.getElementById('sendConfigBtn').addEventListener('click', sendConfigs);
      
      // 执行攻击按钮点击事件
      document.getElementById('executeAttackBtn').addEventListener('click', executeAttack);
      
      // 搜索配置事件
      document.getElementById('searchInput').addEventListener('input', searchConfigs);
      
      // 筛选配置事件
      document.querySelectorAll('.filter-option').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          currentFilter = this.getAttribute('data-filter');
          renderConfigTable();
        });
      });
    });
    
    // 显示添加配置模态框
    function showAddConfigModal() {
      currentConfigId = null;
      document.getElementById('modalTitle').textContent = '添加新攻击配置';
      document.getElementById('configName').value = '';
      document.getElementById('description').value = '';
      document.getElementById('attackType').value = 'AdversarialAttack';
      
      updateAttackStrategies();
      updateAdvancedSettings('AdversarialAttack');
      
      // 显示模态框
      const modal = new bootstrap.Modal(document.getElementById('configModal'));
      modal.show();
    }
    
    // 显示Toast通知
    function showToast(message, type) {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <i class="material-icons">${type === 'success' ? 'check_circle' : 'error'}</i>
        <div>${message}</div>
      `;
      
      toastContainer.appendChild(toast);
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          toastContainer.removeChild(toast);
        }, 300);
      }, 3000);
    }
    
    // 更新统计数据
    function updateStats() {
      const totalConfigs = configList.length;
      const activeConfigs = configList.filter(config => config.status === 'active').length;
      
      document.getElementById('totalConfigs').textContent = totalConfigs;
      document.getElementById('activeConfigs').textContent = activeConfigs;
      document.getElementById('configCounter').textContent = totalConfigs;
      document.getElementById('executedAttacks').textContent = executedAttacks;
      
      // 计算不同攻击类型数量
      const uniqueTypes = new Set(configList.map(config => config.type));
      document.getElementById('attackTypes').textContent = uniqueTypes.size;
    }
    
    // 加载示例配置
    function loadSampleConfigs() {
      configList = [
        {
          id: 1,
          name: "文本对抗攻击配置",
          type: "AdversarialAttack",
          strategy: "TextFoolerJin2019",
          description: "针对NLP模型的文本对抗攻击，通过替换同义词和干扰字符欺骗模型",
          status: "active",
          createdAt: "2023-05-15 10:30",
          params: {
            use_local_model: true,
            attack_nums: 3
          }
        },
        {
          id: 2,
          name: "后门攻击配置",
          type: "BackDoorAttack",
          strategy: "TrojanLM",
          description: "植入后门的攻击配置，在特定触发词出现时改变模型行为",
          status: "inactive",
          createdAt: "2023-05-18 14:20",
          params: {
            sample_metrics: ["accuracy"],
            defender: "None"
          }
        },
        {
          id: 3,
          name: "数据投毒配置",
          type: "PoisoningAttack",
          strategy: "default",
          description: "针对训练数据的投毒攻击，污染训练集以降低模型性能",
          status: "active",
          createdAt: "2023-05-20 09:45",
          params: {
            poisoning_rate: 0.15,
            epochs: 15
          }
        },
        {
          id: 4,
          name: "模型窃取攻击",
          type: "ModelStealingAttack",
          strategy: "default",
          description: "通过查询目标模型来窃取其结构和参数",
          status: "active",
          createdAt: "2023-06-10 14:30",
          params: {
            attack_nums: 3,
            query_num: 500,
            method: "MeaeQ"
          }
        }
      ];
    }
    
    // 渲染配置表格
    function renderConfigTable() {
      const tbody = document.getElementById('configTableBody');
      const noConfigsMessage = document.getElementById('noConfigsMessage');
      
      // 应用筛选
      let filteredConfigs = configList;
      if (currentFilter === 'active') {
        filteredConfigs = filteredConfigs.filter(config => config.status === 'active');
      } else if (currentFilter === 'inactive') {
        filteredConfigs = filteredConfigs.filter(config => config.status === 'inactive');
      }
      
      if (filteredConfigs.length === 0) {
        noConfigsMessage.classList.remove('d-none');
        tbody.innerHTML = '';
        updateStats();
        return;
      }
      
      noConfigsMessage.classList.add('d-none');
      tbody.innerHTML = '';
      
      filteredConfigs.forEach(config => {
        // 获取类型显示名称
        const typeName = attackConfigs.typeNames[config.type] || config.type;
        
        // 生成状态徽章
        const statusBadge = config.status === 'active' ? 
          `<span class="status-badge status-active">活跃</span>` : 
          `<span class="status-badge status-inactive">已禁用</span>`;
        
        // 生成类型徽章
        let badgeClass = 'badge-primary';
        if (config.type === 'BackDoorAttack') badgeClass = 'badge-danger';
        if (config.type === 'ModelStealingAttack') badgeClass = 'badge-info';
        if (config.type === 'PoisoningAttack') badgeClass = 'badge-warning';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${config.name}</td>
          <td><span class="badge ${badgeClass}">${typeName}</span></td>
          <td><span class="badge badge-success">${config.strategy}</span></td>
          <td>${statusBadge}</td>
          <td>${config.createdAt}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-sm btn-outline-primary btn-icon edit-config-btn" data-id="${config.id}">
                <i class="material-icons">edit</i>
              </button>
              <button class="btn btn-sm btn-outline-danger btn-icon delete-config-btn" data-id="${config.id}">
                <i class="material-icons">delete</i>
              </button>
              <button class="btn btn-sm btn-outline-secondary btn-icon toggle-status-btn" data-id="${config.id}">
                <i class="material-icons">${config.status === 'active' ? 'toggle_off' : 'toggle_on'}</i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      // 绑定事件
      tbody.querySelectorAll('.edit-config-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const configId = parseInt(this.getAttribute('data-id'));
          editConfig(configId);
        });
      });
      
      tbody.querySelectorAll('.delete-config-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const configId = parseInt(this.getAttribute('data-id'));
          deleteConfig(configId);
        });
      });
      
      tbody.querySelectorAll('.toggle-status-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const configId = parseInt(this.getAttribute('data-id'));
          toggleConfigStatus(configId);
        });
      });
      
      updateStats();
    }
    
    // 编辑配置
    function editConfig(configId) {
      const config = configList.find(c => c.id === configId);
      if (!config) return;
      
      currentConfigId = configId;
      document.getElementById('modalTitle').textContent = '编辑攻击配置';
      document.getElementById('configName').value = config.name;
      document.getElementById('description').value = config.description;
      document.getElementById('attackType').value = config.type;
      
      updateAttackStrategies();
      document.getElementById('attackStrategy').value = config.strategy;
      updateAdvancedSettings(config.type);
      
      // 填充高级设置
      for (const [key, value] of Object.entries(config.params)) {
        const input = document.getElementById(key);
        if (input) {
          if (input.type === 'checkbox') {
            input.checked = value;
          } else if (input.type === 'select-multiple') {
            // 处理多选字段
            Array.from(input.options).forEach(option => {
              option.selected = value.includes(option.value);
            });
          } else {
            input.value = value;
          }
        }
      }
      
      // 显示模态框
      const modal = new bootstrap.Modal(document.getElementById('configModal'));
      modal.show();
    }
    
    // 删除配置
    function deleteConfig(configId) {
      if (confirm('确定要删除此配置吗？此操作不可撤销。')) {
        configList = configList.filter(c => c.id !== configId);
        renderConfigTable();
        showToast('配置删除成功！', 'success');
      }
    }
    
    // 切换配置状态
    function toggleConfigStatus(configId) {
      const config = configList.find(c => c.id === configId);
      if (config) {
        config.status = config.status === 'active' ? 'inactive' : 'active';
        renderConfigTable();
        showToast(`配置状态已${config.status === 'active' ? '激活' : '禁用'}`, 'success');
      }
    }
    
    // 更新攻击策略下拉菜单
    function updateAttackStrategies() {
      const attackType = document.getElementById('attackType').value;
      const strategies = attackConfigs.recipes[attackType] || ['default'];
      const strategySelect = document.getElementById('attackStrategy');
      
      strategySelect.innerHTML = '';
      strategies.forEach(strategy => {
        const option = document.createElement('option');
        option.value = strategy;
        option.textContent = strategy;
        strategySelect.appendChild(option);
      });
      
      // 更新描述
      document.getElementById('description').value = attackConfigs.descriptions[attackType] || '';
    }
    
    // 更新高级设置区域
    function updateAdvancedSettings(attackType) {
      const settings = attackConfigs.defaults[attackType] || {};
      const container = document.getElementById('advancedSettingsContent');
      
      container.innerHTML = '';
      
      for (const [key, value] of Object.entries(settings)) {
        const label = key.replace(/_/g, ' ')
                        .replace(/\b\w/g, l => l.toUpperCase());
        
        const col = document.createElement('div');
        col.className = 'param-item';
        
        if (attackType === 'BackDoorAttack') {
          // 后门攻击特殊字段处理
          if (key === 'sample_metrics') {
            col.innerHTML = `
              <label class="form-label">样本指标</label>
              <div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="ppl" value="ppl">
                  <label class="form-check-label" for="ppl">PPL</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="use" value="use">
                  <label class="form-check-label" for="use">USE</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="grammar" value="grammar">
                  <label class="form-check-label" for="grammar">语法</label>
                </div>
              </div>
            `;
          } else if (key === 'defender') {
            col.innerHTML = `
              <label class="form-label">防御机制</label>
              <select class="form-control" id="defender">
                <option value="None">无</option>
                <option value="BKI">BKI</option>
                <option value="ONION">ONION</option>
                <option value="STRIP">STRIP</option>
                <option value="RAP">RAP</option>
                <option value="CUBE">CUBE</option>
              </select>
            `;
          } else {
            col.innerHTML = `
              <label class="form-label">${label}</label>
              <input type="text" class="form-control" id="${key}" value="${value}">
            `;
          }
        } else if (attackType === 'ModelStealingAttack') {
          // 模型窃取攻击特殊字段处理
          if (key === 'method') {
            col.innerHTML = `
              <label class="form-label">方法</label>
              <select class="form-control" id="method">
                <option value="RS">随机抽样 (RS)</option>
                <option value="TRF">基于转换 (TRF)</option>
                <option value="DRC">数据重构 (DRC)</option>
                <option value="MeaeQ">MeaeQ</option>
                <option value="AL-RS">主动学习-RS</option>
                <option value="AL-US">主动学习-US</option>
              </select>
            `;
          } else if (key === 'al_sample_method') {
            col.innerHTML = `
              <label class="form-label">主动学习方法</label>
              <select class="form-control" id="al_sample_method">
                <option value="random">随机</option>
                <option value="uncertainty">不确定性</option>
                <option value="dr-greedy-select-min-max">最小-最大贪婪选择</option>
                <option value="dr-greedy-select-max-sum">最大和贪婪选择</option>
              </select>
            `;
          } else {
            col.innerHTML = `
              <label class="form-label">${label}</label>
              <input type="text" class="form-control" id="${key}" value="${value}">
            `;
          }
        } else {
          // 通用处理
          if (typeof value === 'boolean') {
            col.innerHTML = `
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="${key}" ${value ? 'checked' : ''}>
                <label class="form-check-label" for="${key}">${label}</label>
              </div>
            `;
          } else if (Array.isArray(value)) {
            col.innerHTML = `
              <label class="form-label">${label}</label>
              <input type="text" class="form-control" id="${key}" value="${value.join(', ')}">
            `;
          } else if (typeof value === 'number') {
            col.innerHTML = `
              <label class="form-label">${label}</label>
              <input type="number" class="form-control" id="${key}" value="${value}">
            `;
          } else {
            col.innerHTML = `
              <label class="form-label">${label}</label>
              <input type="text" class="form-control" id="${key}" value="${value}">
            `;
          }
        }
        
        container.appendChild(col);
      }
    }
    
    // 保存配置
    function saveConfig() {
      const configName = document.getElementById('configName').value;
      if (!configName) {
        showToast('请填写配置名称', 'error');
        return;
      }
      
      const attackType = document.getElementById('attackType').value;
      const attackStrategy = document.getElementById('attackStrategy').value;
      const description = document.getElementById('description').value;
      
      // 收集高级设置
      const params = {};
      const settings = attackConfigs.defaults[attackType] || {};
      
      for (const key of Object.keys(settings)) {
        const input = document.getElementById(key);
        
        if (input) {
          if (attackType === 'BackDoorAttack' && key === 'sample_metrics') {
            // 处理后门攻击的样本指标多选框
            params[key] = [];
            if (document.getElementById('ppl').checked) params[key].push('ppl');
            if (document.getElementById('use').checked) params[key].push('use');
            if (document.getElementById('grammar').checked) params[key].push('grammar');
          } else if (input.type === 'checkbox') {
            params[key] = input.checked;
          } else if (input.type === 'number') {
            params[key] = parseFloat(input.value);
          } else {
            params[key] = input.value;
          }
        }
      }
      
      const newConfig = {
        id: currentConfigId || Date.now(),
        name: configName,
        type: attackType,
        strategy: attackStrategy,
        description: description,
        status: 'active',
        createdAt: new Date().toLocaleString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        }),
        params: params
      };
      
      if (currentConfigId) {
        // 更新现有配置
        const index = configList.findIndex(c => c.id === currentConfigId);
        if (index !== -1) {
          configList[index] = newConfig;
        }
      } else {
        // 添加新配置
        configList.push(newConfig);
      }
      
      // 更新表格
      renderConfigTable();
      
      // 关闭模态框
      const modal = bootstrap.Modal.getInstance(document.getElementById('configModal'));
      modal.hide();
      
      // 显示成功消息
      showToast(`配置"${configName}"保存成功！`, 'success');
    }
    
    // 发送配置
    function sendConfigs() {
      // 过滤出活跃状态的配置
      const activeConfigs = configList.filter(config => config.status === 'active');
      if (activeConfigs.length === 0) {
        showToast('没有可发送的配置', 'error');
        return;
      }
      
      showToast('配置已发送到服务器', 'success');
    }
    
    // 执行攻击
    function executeAttack() {
      const activeConfigs = configList.filter(config => config.status === 'active');
      
      if (activeConfigs.length === 0) {
        showToast('没有可执行的活跃配置', 'error');
        return;
      }
      
      executedAttacks++;
      updateStats();
      showToast('攻击执行成功！', 'success');
    }
    
    // 搜索配置
    function searchConfigs() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      if (!searchTerm) {
        renderConfigTable();
        return;
      }
      
      const filteredConfigs = configList.filter(config => 
        config.name.toLowerCase().includes(searchTerm) || 
        config.type.toLowerCase().includes(searchTerm) || 
        config.strategy.toLowerCase().includes(searchTerm) || 
        config.description.toLowerCase().includes(searchTerm)
      );
      
      renderFilteredConfigs(filteredConfigs);
    }
    
    // 渲染筛选后的配置
    function renderFilteredConfigs(filteredConfigs) {
      const tbody = document.getElementById('configTableBody');
      const noConfigsMessage = document.getElementById('noConfigsMessage');
      
      if (filteredConfigs.length === 0) {
        noConfigsMessage.classList.remove('d-none');
        tbody.innerHTML = '';
        return;
      }
      
      noConfigsMessage.classList.add('d-none');
      tbody.innerHTML = '';
      
      filteredConfigs.forEach(config => {
        // 获取类型显示名称
        const typeName = attackConfigs.typeNames[config.type] || config.type;
        
        // 生成状态徽章
        const statusBadge = config.status === 'active' ? 
          `<span class="status-badge status-active">活跃</span>` : 
          `<span class="status-badge status-inactive">已禁用</span>`;
        
        // 生成类型徽章
        let badgeClass = 'badge-primary';
        if (config.type === 'BackDoorAttack') badgeClass = 'badge-danger';
        if (config.type === 'ModelStealingAttack') badgeClass = 'badge-info';
        if (config.type === 'PoisoningAttack') badgeClass = 'badge-warning';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${config.name}</td>
          <td><span class="badge ${badgeClass}">${typeName}</span></td>
          <td><span class="badge badge-success">${config.strategy}</span></td>
          <td>${statusBadge}</td>
          <td>${config.createdAt}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-sm btn-outline-primary btn-icon edit-config-btn" data-id="${config.id}">
                <i class="material-icons">edit</i>
              </button>
              <button class="btn btn-sm btn-outline-danger btn-icon delete-config-btn" data-id="${config.id}">
                <i class="material-icons">delete</i>
              </button>
              <button class="btn btn-sm btn-outline-secondary btn-icon toggle-status-btn" data-id="${config.id}">
                <i class="material-icons">${config.status === 'active' ? 'toggle_off' : 'toggle_on'}</i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      // 绑定事件
      tbody.querySelectorAll('.edit-config-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const configId = parseInt(this.getAttribute('data-id'));
          editConfig(configId);
        });
      });
      
      tbody.querySelectorAll('.delete-config-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const configId = parseInt(this.getAttribute('data-id'));
          deleteConfig(configId);
        });
      });
      
      tbody.querySelectorAll('.toggle-status-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const configId = parseInt(this.getAttribute('data-id'));
          toggleConfigStatus(configId);
        });
      });
    }
  </script>
</body>
</html>